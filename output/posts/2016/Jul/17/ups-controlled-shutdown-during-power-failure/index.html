<!DOCTYPE html>         <!-- This is the HTML5 doctype -->
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:og="http://ogp.me/ns#"
      xmlns:fb="https://www.facebook.com/2008/fbml">
<head>
    <title>UPS Controlled Shutdown During Power Failure - Jeff's Skinner Box</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link href="../../../../../favicon.ico" rel="icon">

    <!-- Open Graph tags -->
            <meta property="og:type" content="article"/>
            <meta property="og:title" content="UPS Controlled Shutdown During Power Failure"/>
            <meta property="og:url" content="../../../../../posts/2016/Jul/17/ups-controlled-shutdown-during-power-failure/"/>
            <meta property="og:description" content="I purchased a uninterruptible power supply, to smooth out the power dips that are far too frequent in my home. This article show you how to integrate it with Linux so in the event of a total power failure, your Linux system can monitor the UPS status and perform a graceful shutdown if the UPS power runs low."/>

    <!-- Bootstrap -->
        <link href="../../../../../theme/css/bootstrap.flatly.min.css" rel="stylesheet" type="text/css"/>

    <!-- Font Awesome and Google Fonts -->
    <link href="../../../../../theme/css/font-awesome.min.css" rel="stylesheet">
    <link href='http://fonts.googleapis.com/css?family=Knewave' rel='stylesheet' type='text/css'>

    <link href="../../../../../theme/css/pygments/default.css" rel="stylesheet">
    <link href="../../../../../theme/css/style.css" rel="stylesheet" type="text/css"/>
        <link href="../../../../../static/custom.css" rel="stylesheet">

</head>

<body>
<div class="navbar navbar-default navbar-fixed-top" role="navigation" style="box-shadow: 5px 5px 10px #888888;">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="../../../../../" style="font-family: Knewave, cursive; font-size: 48px; color: #FFFFFF">
Jeff's Skinner Box&nbsp;            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                    <li><a href="/pages/about-me/">About Me</a></li>
                    <li><a href="http://127.0.0.1:8080">MicroContent</a></li>
                    <li><a href="/pages/open-notebook/">Open Notebook</a></li>
            </ul>
            <ul class="nav navbar-nav">
                <li><a href="../../../../../archives.html">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
  <!-- GitHub Ribbon - https://github.com/blog/273-github-ribbons -->
<!-- GitHub Ribbon - https://github.com/blog/273-github-ribbons -->
    <a href="https://github.com/jeffskinnerbox/jeffskinnerbox.github.io/tree/source" target="_blank">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://github-camo.global.ssl.fastly.net/365986a132ccd6a44c23a9169022c0b5c890c387/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f7265645f6161303030302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png">
    </a>
</div> <!-- /.navbar -->

<div class="container">
    <div class="row">
        <div class="col-sm-9">

    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="../../../../../posts/2016/Jul/17/ups-controlled-shutdown-during-power-failure/"
                       rel="bookmark"
                       title="Permalink to UPS Controlled Shutdown During Power Failure">
                        UPS Controlled Shutdown During Power Failure
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2016-07-17T18:46:00-04:00"> Sunday&nbsp;&nbsp;&nbsp;&nbsp;July 17, 2016</time>
    </span>



&nbsp;&nbsp;&nbsp;
<i class="fa fa-tags fa-lg"></i>
    <a class="btn btn-default btn-xs" href="../../../../../tag/ups/">UPS</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p><a href="http://www.apcmedia.com/salestools/JGNY-8XT6LC/JGNY-8XT6LC_R1_EN.pdf?sdirect=true">
    <img class="img-rounded" style="margin: 0px 8px; float: left" title="APC Back-UPS 1080 Provides Battery Backup & Surge Protector for Electronics and Computers (Front Image)" alt="WABAC Pic" src="/images/APC_Back-UPS_NS_1080_front.jpg" width="156" height="250" />
</a>
<a href="http://www.apcmedia.com/salestools/JGNY-8XT6LC/JGNY-8XT6LC_R1_EN.pdf?sdirect=true">
    <img class="img-rounded" style="margin: 0px 8px; float: left" title="APC Back-UPS 1080 Provides Battery Backup & Surge Protector for Electronics and Computers (Back Image)" alt="WABAC Pic" src="/images/APC_Back-UPS_NS_1080_back.jpg" width="119" height="250" />
</a>
I purchased a <a href="http://en.wikipedia.org/wiki/Uninterruptible_power_supply">uninterruptible power supply</a>,
specifically the <a href="https://www.apc.com/products/resource/include/techspec_index.cfm?base_sku=BN1080G&amp;tab=documentation">APC Back-UPS NS 1080</a>,
to smooth out the power dips that are far too frequent in my home.
This product comes with the <a href="http://www.apc.com/products/family/?id=129">PowerChute</a> software to provide safe system shutdown
in the event of an extended power outage.
Unfortunately, this software isn't supported on Linux,
but there is an alternative to PowerChute.</p>
<p><a href="http://en.wikipedia.org/wiki/Apcupsd"><code>apcupsd</code></a> (the name stands for APC UPS Daemon) is a <a href="http://en.wikipedia.org/wiki/Daemon_(computing)">daemon</a> that runs on Linux
that allows the computer to interact with (almost all recent)
<a href="http://www.apc.com/">American Power Conversion Corp (APC)</a>
<a href="http://en.wikipedia.org/wiki/Uninterruptible_power_supply">uninterruptible power supplies (UPS)</a>.
During a power failure, <code>apcupsd</code> informs users about the loss of utility power
and that a shutdown may occur.
If utility power is not restored,
a system shutdown will follow when the battery is exhausted, a specified timeout expires,
a specified battery charge percentage is reached,
or a specified battery runtime
(based on internal UPS calculations and determined by power consumption rates) expires.
If the utility power is restored before one of the these shutdown conditions is met,
<code>apcupsd</code> will inform users of this and the shutdown will generally be cancelled.</p>
<h1>Installation</h1>
<p>For my UPS,
the  <code>apcupsd</code> daemon will be communicating with the UPS via a USB connection.
To make sure that your USB subsystem can see the UPS,
plug in the UPS and connect the USB cable to your computer.
Then just run <code>lsusb</code> from a shell prompt (see below, output included):</p>
<div class="codehilite" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span><span style="color: #0099FF; font-style: italic"># the lsusb command can show you the hubs connected to your system</span>
$ lsusb | grep American

Bus <span style="color: #FF6600">003</span> Device 005: ID 051d:0002 American Power Conversion Uninterruptible Power Supply
</pre></div>


<h2>Device File Name for the UPS</h2>
<p>Under Linux, each and every hardware device, including USB ports,
are treated as a file and call a <a href="http://en.wikipedia.org/wiki/Device_file">device file</a>.
A device file allows a user to access hardware devices,
but shields the users from the technical details about the hardware.
A conventional serial port will typically have a device file such as
<code>/dev/ttyS0</code>, <code>/dev/ttyS1</code>, etc. but a USB serial ports can appear as
<code>/dev/ttyUSB0</code>, <code>/dev/ttyUSB1</code>, etc. or even appear in <code>/dev/usb</code> as in my Ubuntu Linux system.</p>
<p>When your device is plugged in, Linux assigns the device file name
as it sees fit and isn’t always predicable (<a href="http://hintshop.ludvig.co.nz/show/persistent-names-usb-serial-devices/">it doesn’t have to be this way</a>).
From the output of <code>lsusb</code>, you can deduce what device file your serial device is connected too.
The string <code>Bus 003 Device 005</code> and a search of the directory <code>/dev/bus</code>
tells you that the device file is <code>/dev/bus/usb/003/005</code>.</p>
<p>Linux creates device nodes dynamically on the fly as they are needed.
It is basically a hotplug system, freeing the user from  making node assignments,
but also means you have to search around to find where Linux put your device file.
The <code>apcupsd</code> takes care of all this, so you don't need to create a
<a href="http://hintshop.ludvig.co.nz/show/persistent-names-usb-serial-devices/">persistent device name</a>.</p>
<p>Never the less, if your curious about where things are located,
running of the <code>lsusb</code> command above tells us
UPS's VendorID:ProductID pair is <code>051d:0002</code>.
Using the <code>udevadm info -a -n /dev/bus/usb/003/005</code> command,
you conclude that the serial number of the device is <code>0000:00:14.0</code>.
See below: (command and output)</p>
<div class="codehilite" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span><span style="color: #0099FF; font-style: italic"># get the serial number of the UPS device</span>
udevadm info -a -n /dev/bus/usb/003/005 | grep ATTRS<span style="color: #555555">{</span>serial<span style="color: #555555">}</span>

    ATTRS<span style="color: #555555">{</span>serial<span style="color: #555555">}==</span><span style="color: #CC3300">&quot;0000:00:14.0&quot;</span>
</pre></div>


<p>Armed with this information and following guidance from <a href="http://hackaday.com/2009/09/18/how-to-write-udev-rules/">this post</a>,
I could have update the <a href="http://hintshop.ludvig.co.nz/show/persistent-names-usb-serial-devices/">UDEV rules</a>.
But <strong>Don't Do This</strong>, since from my experimenting,
I believe it will cause problems with <code>apcupsd</code>.
It appears that the daemon is designed to deal with all this.</p>
<h2>Installing and Configuring the UPS Daemon</h2>
<p>The <code>apcupsd</code> daemon is easy to install
and is well documented at "<a href="https://help.ubuntu.com/community/apcupsd">apcupsd - Official Ubuntu Documentation</a>".
If you want to see the stat of the UPS through the browser,
you can also install <code>apcupsd-cgi</code> package.</p>
<div class="codehilite" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span><span style="color: #0099FF; font-style: italic"># install the apcupsd daemon and browser package</span>
sudo apt-get install apcupsd apcupsd-cgi
</pre></div>


<p>Next you edit the <code>apcupsd</code> configuration file <code>/etc/apcupsd/apcupsd.conf</code>.
Here are the modifications I made to this file:</p>
<div class="codehilite" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span><span style="color: #0099FF; font-style: italic"># UPS name, max 8 characters</span>
UPSNAME HOME_UPS

<span style="color: #0099FF; font-style: italic"># Defines the type of cable connecting the UPS to your computer.</span>
UPSCABLE usb

<span style="color: #0099FF; font-style: italic"># the type of UPS you have</span>
UPSTYPE usb

<span style="color: #0099FF; font-style: italic"># with a usb type UPS apcupsd can autodetect the device,</span>
<span style="color: #0099FF; font-style: italic"># so you should comment out the DEVICE setting</span>
<span style="color: #0099FF; font-style: italic">#DEVICE /dev/ttyS0</span>

<span style="color: #0099FF; font-style: italic"># UPS should do a self test every two weeks</span>
SELFTEST 336
</pre></div>


<p>Now you must edit the file <code>/etc/default/apcupsd</code>.</p>
<div class="codehilite" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span><span style="color: #0099FF; font-style: italic"># Defaults for apcupsd initscript</span>

<span style="color: #0099FF; font-style: italic"># Apcupsd-devel internal configuration</span>
<span style="color: #003333">APCACCESS</span><span style="color: #555555">=</span>/sbin/apcaccess
<span style="color: #003333">ISCONFIGURED</span><span style="color: #555555">=</span>yes
</pre></div>


<h1>Starting Things Up</h1>
<p>To start/stop the <code>apcupsd</code> daemon manually, just execute this command:</p>
<div class="codehilite" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span><span style="color: #0099FF; font-style: italic"># start the apcupsd daemon</span>
sudo /etc/init.d/apcupsd start

<span style="color: #0099FF; font-style: italic"># to check if the demon is in fact running</span>
ps aux | grep --invert-match grep | grep apcupsd

<span style="color: #0099FF; font-style: italic"># stop the apcupsd daemon</span>
sudo /etc/init.d/apcupsd stop
</pre></div>


<p>The UPS daemon can be manual started/stopped, but also,
the command <code>/etc/init.d/apcupsd</code> is automatically invoked at system startup and shutdown
and is governed by the <a href="http://linux.die.net/man/8/chkconfig"><code>chkconfig</code></a> procedures.</p>
<p>To get a snapshot of the UPS's status, run the command <code>apcaccess status</code>.</p>
<p>See the output below:</p>
<div class="codehilite" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span><span style="color: #0099FF; font-style: italic"># UPS status check</span>
$ apcaccess status

APC      : 001,036,0901
DATE     : 2015-02-07 10:59:40 -0500
HOSTNAME : desktop
VERSION  : 3.14.10 <span style="color: #555555">(</span><span style="color: #FF6600">13</span> September 2011<span style="color: #555555">)</span> debian
UPSNAME  : desktop
CABLE    : USB Cable
DRIVER   : USB UPS Driver
UPSMODE  : Stand Alone
STARTTIME: 2015-02-07 10:59:39 -0500
MODEL    : Back-UPS NS1080G
STATUS   : ONLINE
LINEV    : 121.0 Volts
LOADPCT  :  20.0 Percent Load Capacity
BCHARGE  : 100.0 Percent
TIMELEFT :  36.1 Minutes
MBATTCHG : <span style="color: #FF6600">5</span> Percent
MINTIMEL : <span style="color: #FF6600">3</span> Minutes
MAXTIME  : <span style="color: #FF6600">0</span> Seconds
SENSE    : Medium
LOTRANS  : 088.0 Volts
HITRANS  : 142.0 Volts
ALARMDEL : <span style="color: #FF6600">30</span> seconds
BATTV    : 27.0 Volts
LASTXFER : No transfers since turnon
NUMXFERS : 0
TONBATT  : <span style="color: #FF6600">0</span> seconds
CUMONBATT: <span style="color: #FF6600">0</span> seconds
XOFFBATT : N/A
SELFTEST : NO
STATFLAG : 0x07000008 Status Flag
SERIALNO : 3B1405X05714
BATTDATE : 2014-01-28
NOMINV   : <span style="color: #FF6600">120</span> Volts
NOMBATTV :  24.0 Volts
NOMPOWER : <span style="color: #FF6600">650</span> Watts
FIRMWARE : 914.L2   .D USB FW:
END APC  : 2015-02-07 10:59:43 -0500
</pre></div>


<p>This shows that the UPS daemon is configured to do the following thing:</p>
<table>
<thead>
<tr>
<th align="left">Parameter</th>
<th align="center">Value</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">MBATTCHG</td>
<td align="center">5%</td>
<td align="left">If the battery charge percentage (BCHARGE) drops below this value, apcupsd will shutdown your system. Value is set in the configuration file (BATTERYLEVEL).</td>
</tr>
<tr>
<td align="left">MINTIMEL</td>
<td align="center">3 Min</td>
<td align="left">apcupsd will shutdown your system if the remaining runtime equals or is below this point.  Value is set in the configuration file (MINUTES).</td>
</tr>
<tr>
<td align="left">MAXTIME</td>
<td align="center">0 Sec</td>
<td align="left">apcupsd will shutdown your system if the time on batteries exceeds this value.  A value of zero disables the feature. Value is set in the configuration file (TIMEOUT).</td>
</tr>
</tbody>
</table>
<p>These parameters say something about how the UPS is perfroming
(see <a href="http://www.apcupsd.com/manual/manual.html#apcupsd-status-logging">apcupsd Status Logging</a> section in the apcupsd User Manual):</p>
<table>
<thead>
<tr>
<th align="left">Parameter</th>
<th align="center">Value</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">STARTTIME</td>
<td align="center">time stamp</td>
<td align="left">The time/date that <code>apcupsd</code> was started (ex. 2015-02-07 10:59:39 -0500).</td>
</tr>
<tr>
<td align="left">STATUS</td>
<td align="center">ONLINE</td>
<td align="left">The current status of the UPS (ONLINE, ONBATT, etc.)</td>
</tr>
<tr>
<td align="left">LINEV</td>
<td align="center">121.0 V</td>
<td align="left">The current line voltage as returned by the UPS.</td>
</tr>
<tr>
<td align="left">LOADPCT</td>
<td align="center">20.0%</td>
<td align="left">The percentage of load capacity as estimated by the UPS.</td>
</tr>
<tr>
<td align="left">BCHARGE</td>
<td align="center">100.0%</td>
<td align="left">The percentage charge on the batteries.</td>
</tr>
<tr>
<td align="left">TIMELEFT</td>
<td align="center">36.1</td>
<td align="left">The remaining runtime left, in minutes on batteries as estimated by the UPS.</td>
</tr>
<tr>
<td align="left">LOTRANS</td>
<td align="center">088.0 V</td>
<td align="left">The line voltage below which the UPS will switch to batteries.</td>
</tr>
<tr>
<td align="left">HITRANS</td>
<td align="center">142.0 V</td>
<td align="left">The line voltage above which the UPS will switch to batteries.</td>
</tr>
<tr>
<td align="left">SELFTEST</td>
<td align="center">NO</td>
<td align="left">The results of the last self test, and may have the following values: OK - self test indicates good battery, BT - self test failed due to insufficient battery capacity, NG - self test failed due to overload, NO - No results (i.e. no self test performed in the last 5 minutes)</td>
</tr>
</tbody>
</table>
<h1>Notification and Events</h1>
<p>When a major event is generated within <code>apcupsd</code>,
control is passed to the script <code>/etc/apcupsd/apccontrol</code>.
The event name, and a number of other important parameters are passed to the script.
The major function of the <code>apccontrol</code> script is to perform a shutdown of the system
(as well as the killpower operation).
Another major task for this script is to notify you (via <a href="http://linux.die.net/man/1/wall"><code>wall</code></a> by default)
when certain events such as powerfail occur.</p>
<p>Since <code>/etc/apcupsd/apccontrol</code> is a script,
you can customize it to your own needs using any text editor.
In addition, another feature is that you can write your own scripts
that will be automatically called by <code>apccontrol</code> before any of its own code is executed.
For more details, see the <a href="http://www.apcupsd.com/manual/manual.html#apcupsd-notification-and-events">apcupsd User Manual</a>.</p>
<p>By default, the <code>/etc/apcupsd/apccontrol</code> script uses <a href="http://linux.die.net/man/1/wall"><code>wall</code></a>
to notify online uses of UPS related events.
I wanted modify the script to use <a href="http://www.computerhope.com/unix/usendmai.htm"><code>sendmail</code></a>
but many public mail servers appear to block the
Simple Mail Transfer Protocol (SMTP) coming from unknow sources.
See below for my systems mail log, <code>/var/log/mail.log</code>:</p>
<div class="codehilite" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span><span style="color: #0099FF; font-style: italic"># test message for send mail</span>
$ <span style="color: #336666">echo</span> <span style="color: #CC3300">&quot;Subject: sendmail test&quot;</span> | /usr/sbin/sendmail jeff.irland@verizon.net

<span style="color: #0099FF; font-style: italic"># now check the log to see what happend to this message</span>
$ tail /var/log/mail.log
.
.
.
Jul <span style="color: #FF6600">16</span> 14:21:05 desktop postfix/pickup<span style="color: #555555">[</span>6588<span style="color: #555555">]</span>: 723364012A: <span style="color: #003333">uid</span><span style="color: #555555">=</span><span style="color: #FF6600">1000</span> <span style="color: #003333">from</span><span style="color: #555555">=</span>&lt;jeff&gt;
Jul <span style="color: #FF6600">16</span> 14:21:05 desktop postfix/cleanup<span style="color: #555555">[</span>8835<span style="color: #555555">]</span>: 723364012A: message-id<span style="color: #555555">=</span>&lt;20160716182105.723364012A@desktop.fios-router.home&gt;
Jul <span style="color: #FF6600">16</span> 14:21:05 desktop postfix/qmgr<span style="color: #555555">[</span>2208<span style="color: #555555">]</span>: 723364012A: <span style="color: #003333">from</span><span style="color: #555555">=</span>&lt;jeff@jeff.irland@gmail.com&gt;, <span style="color: #003333">size</span><span style="color: #555555">=</span>307, <span style="color: #003333">nrcpt</span><span style="color: #555555">=</span><span style="color: #FF6600">1</span> <span style="color: #555555">(</span>queue active<span style="color: #555555">)</span>
Jul <span style="color: #FF6600">16</span> 14:21:05 desktop postfix/smtp<span style="color: #555555">[</span>8810<span style="color: #555555">]</span>: 723364012A: <span style="color: #003333">to</span><span style="color: #555555">=</span>&lt;jeff.irland@verizon.net&gt;, <span style="color: #003333">relay</span><span style="color: #555555">=</span>relay.verizon.net<span style="color: #555555">[</span>206.46.232.11<span style="color: #555555">]</span>:25, <span style="color: #003333">delay</span><span style="color: #555555">=</span>0.1, <span style="color: #003333">delays</span><span style="color: #555555">=</span>0.01/0/0.09/0, <span style="color: #003333">dsn</span><span style="color: #555555">=</span>4.0.0, <span style="color: #003333">status</span><span style="color: #555555">=</span>deferred <span style="color: #555555">(</span>host relay.verizon.net<span style="color: #555555">[</span>206.46.232.11<span style="color: #555555">]</span> refused to talk to me: <span style="color: #FF6600">571</span> Email from 71.171.94.138 is currently blocked by Verizon Online<span style="color: #AA0000; background-color: #FFAAAA">&#39;</span>s anti-spam system. The email sender or Email Service Provider may visit http://www.verizon.net/whitelist and request removal of the block. 160716<span style="color: #555555">)</span>
</pre></div>


<p>As the last line says,
the Verizon mail service is blocking my <code>sendmail</code> message via its anti-spam system.</p>
<p>Instead, I choose to take another approach.
I have modified the <code>apccontrol</code> script to not only use <code>wall</code> but also
<a href="https://gist.github.com/jeffskinnerbox/13cd61e4d99feb0dcbca">my personal push notification utility <code>apprise</code></a>,
which leverages the <a href="https://pushover.net/">Pushover</a> service.
(<strong>WARNING -</strong> The <code>/etc/apcupsd/apccontrol</code> script will be overwritten every time you update
your <code>apcupsd</code>, when doing <code>make install</code>):</p>
<p>The modifications to the <code>/etc/apcupsd/apccontrol</code> script
required me to replace the scripts <code>WALL</code> environment variable as shown below:</p>
<div class="codehilite" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span><span style="color: #0099FF; font-style: italic"># repleae this line</span>
<span style="color: #003333">WALL</span><span style="color: #555555">=</span>wall

<span style="color: #0099FF; font-style: italic"># with this</span>
<span style="color: #003333">WALL</span><span style="color: #555555">=</span><span style="color: #CC3300">&quot;eval tee /tmp/apccontrol.file | wall ; /home/jeff/bin/apprise -t \&quot;UPS Event Notification\&quot; -m \&quot;\$(cat /tmp/apccontrol.file)\&quot;&quot;</span>
</pre></div>


<h1>UPS Test Program</h1>
<p><a href="http://linux.die.net/man/8/apctest"><code>apctest</code></a> is a program that runs low-level tests to check the operation of the UPS,
checks that your <code>apcupsd</code> configuration is correctly setup,
and assures you can establish communication with the UPS.</p>
<p>When run, <code>apctest</code> displays a menu of options.
Also, <code>apctest</code> saves a transcript of the session to the file <code>apctest.out</code>
in the directory from which the program was called.</p>
<blockquote>
<p><strong>IMPORTANT:</strong> Before running <code>apctest</code>
 Check that the UPSCABLE, UPSTYPE and DEVICE configuration directives in the
<code>/etc/apcupsd/apcupsd.conf</code>
configuration file have been set appropriately;
and <strong>shutdown <code>apcupsd</code></strong> via <code>sudo /etc/init.d/apcupsd stop</code> if it is running.
You cannot run both <code>apcupsd</code> and <code>apctest</code> at the same time.</p>
</blockquote>
<p>You must run <code>apctest</code> as root:</p>
<div class="codehilite" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span><span style="color: #0099FF; font-style: italic"># stop the apcupsd daemon</span>
sudo /etc/init.d/apcupsd stop

<span style="color: #0099FF; font-style: italic"># start the test</span>
$ sudo apctest


2016-07-16 16:34:56 apctest 3.14.12 <span style="color: #555555">(</span><span style="color: #FF6600">29</span> March 2014<span style="color: #555555">)</span> debian
Checking configuration ...
sharenet.type <span style="color: #555555">=</span> Network &amp; ShareUPS Disabled
cable.type <span style="color: #555555">=</span> USB Cable
mode.type <span style="color: #555555">=</span> USB UPS Driver
Setting up the port ...
Doing prep_device<span style="color: #555555">()</span> ...

You are using a USB cable type, so I<span style="color: #AA0000; background-color: #FFAAAA">&#39;</span>m entering USB <span style="color: #336666">test</span> mode
Hello, this is the apcupsd Cable Test program.
This part of apctest is <span style="color: #006699; font-weight: bold">for</span> testing USB UPSes.

Getting UPS capabilities...SUCCESS

Please <span style="color: #006699; font-weight: bold">select</span> the <span style="color: #006699; font-weight: bold">function</span> you want to perform.

1<span style="color: #555555">)</span>  Test <span style="color: #336666">kill</span> UPS power
2<span style="color: #555555">)</span>  Perform self-test
3<span style="color: #555555">)</span>  Read last self-test result
4<span style="color: #555555">)</span>  View/Change battery date
5<span style="color: #555555">)</span>  View manufacturing date
6<span style="color: #555555">)</span>  View/Change alarm behavior
7<span style="color: #555555">)</span>  View/Change sensitivity
8<span style="color: #555555">)</span>  View/Change low transfer voltage
9<span style="color: #555555">)</span>  View/Change high transfer voltage
10<span style="color: #555555">)</span> Perform battery calibration
11<span style="color: #555555">)</span> Test alarm
12<span style="color: #555555">)</span> View/Change self-test interval
 Q<span style="color: #555555">)</span> Quit

Select <span style="color: #006699; font-weight: bold">function</span> number:
.
.
.

<span style="color: #0099FF; font-style: italic"># start the apcupsd daemon</span>
sudo /etc/init.d/apcupsd start
</pre></div>


<h1>Sources</h1>
<p>For more information and details, check out the following:</p>
<ul>
<li><a href="http://www.apcupsd.org/">APC UPS Daemon</a></li>
<li><a href="http://www.apcupsd.com/manual/manual.html">apcupsd User Manual</a></li>
<li><a href="http://www.cyberciti.biz/faq/debian-ubuntu-centos-rhel-install-apcups/">Linux: Configure and Control APC SmartUPS During a Power Failure</a></li>
<li><a href="http://www.cloudportal.org/2012/03/07/installing-apc-ups-powerchute-network-shutdown-3-0-0-on-ubuntu-10-04-lts/">Configuring Linux Ubuntu 10.04 LTS for APC UPS Network Shutdown</a></li>
<li><a href="http://linux.die.net/man/8/apcupsd">apcupsd - a daemon for controlling most APC UPS</a></li>
<li><a href="http://linux.die.net/man/5/apcupsd.conf">apcupsd.conf - the configuration file for the apcupsd program</a></li>
</ul><script type= "text/javascript">
    if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
        var mathjaxscript = document.createElement('script');
        mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
        mathjaxscript.type = 'text/javascript';
        mathjaxscript.src = 'https:' == document.location.protocol
		? 'https://c328740.ssl.cf1.rackcdn.com/mathjax/latest/MathJax.js'
		: 'http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
        mathjaxscript[(window.opera ? "innerHTML" : "text")] =
            "MathJax.Hub.Config({" +
            "    config: ['MMLorHTML.js']," +
            "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
            "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
            "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
            "    displayAlign: 'center'," +
            "    displayIndent: '0em'," +
            "    showMathMenu: true," +
            "    tex2jax: { " +
            "        inlineMath: [ ['$','$'] ], " +
            "        displayMath: [ ['$$','$$'] ]," +
            "        processEscapes: true," +
            "        preview: 'TeX'," +
            "    }, " +
            "    'HTML-CSS': { " +
            "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'black ! important'} }" +
            "    } " +
            "}); ";
        (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
    }
</script>

            </div>
            <!-- /.entry-content -->
        </article>
    </section>

        </div>
        <div class="col-sm-3 well well-sm" id="sidebar" style="box-shadow: 5px 5px 10px #888888;">

<aside>
    <section>
        <ul class="list-group list-group-flush">
                <div style="text-align: center;">
                    <h3><a href="../../../../../pages/about-me/" style="font-family: Knewave, cursive; font-size: 18;">My Electronics Projects And Other Diversions</a>
                    <a href="../../../../../pages/about-me/">
                        <img class="img-rounded" src="../../../../../extra/frustrated-engineer.jpg" alt="Side Bar Picture" height="100%" width="100%">
                    </a>
                </div>

            <font color=#990000>
                <li class="list-group-item"><a href="../../../../../pages/"><h4><i class="fa fa-exclamation-triangle fa-lg"></i><span class="icon-label">Testing Zone</span></h4></a>
                </li>

                <li class="list-group-item"><a href="../../../../../drafts/"><h4><i class="fa fa-edit fa-lg"></i><span class="icon-label">Draft Articles</span></h4></a>
                </li>
            </font>

            <li class="list-group-item"><a href="../../../../../categories.html"><h4><i class="fa fa-folder-open fa-lg"></i><span class="icon-label">Categories</span></h4></a>
            </li>

            <li class="list-group-item"><a href="../../../../../tags.html"><h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Tags</span></h4></a>
            </li>

            <li class="list-group-item"><a href="../../../../../index.html"><h4><i class="fa fa-clock-o fa-lg"></i><span class="icon-label">Recent Posts</span></h4></a>
            </li>

            <li class="list-group-item"><a href="../../../../../pages/open-notebook/index.html"><h4><i class="fa fa-book fa-lg"></i><span class="icon-label">Open Notebook</span></h4></a>

<li class="list-group-item"><h4><i class="fa fa-file-text fa-lg"></i><span class="icon-label">Site Pages</span></h4>
    <ul class="list-group" id="links">
        <li class="list-group-item">
            <a href="/pages/linux-and-python-packages-for-my-raspberry-pi/index.html" target="_blank">
                RPi Packages
            </a>
        </li>
        <li class="list-group-item">
            <a href="/tag/how-to/index.html" target="_blank">
                How To
            </a>
        </li>
        <li class="list-group-item">
            <a href="/tag/cheat-sheet/index.html" target="_blank">
                Cheat Sheets
            </a>
        </li>
    </ul>
</li>
<li class="list-group-item"><h4><i class="fa fa-puzzle-piece fa-lg"></i><span class="icon-label">MicroContent</span></h4>
    <ul class="list-group" id="wiki">
        <li class="list-group-item">
            <a href="http://127.0.0.1:8080/#Potential Projects" target="_blank">
                Project Ideas
            </a>
        </li>
        <li class="list-group-item">
            <a href="http://127.0.0.1:8080/#Topics for Study" target="_blank">
                Things to Study
            </a>
        </li>
    </ul>
</li>
<li class="list-group-item"><h4><i class="fa fa-link fa-lg"></i><span class="icon-label">External Links</span></h4>
    <ul class="list-group" id="links">
        <li class="list-group-item">
            <a href="http://tiddlywiki.com/" target="_blank">
                TiddlyWiki
            </a>
        </li>
    </ul>
</li>
<li class="list-group-item"><h4><i class="fa fa-group fa-lg"></i><span class="icon-label">Social Media</span></h4>
    <ul class="list-group" id="social">
        <li class="list-group-item"><a href="https://github.com/jeffskinnerbox" target="_blank">
            <i class="fa fa-github"></i> Github
        </a></li>
        <li class="list-group-item"><a href="https://hackaday.io/jeffskinnerbox" target="_blank">
            <i class="fa fa-hacker-news"></i> Hackaday
        </a></li>
        <li class="list-group-item"><a href="https://twitter.com/jeffskinnerbox" target="_blank">
            <i class="fa fa-twitter"></i> Twitter
        </a></li>
        <li class="list-group-item"><a href="https://www.flickr.com/photos/104241758@N03/" target="_blank">
            <i class="fa fa-flickr"></i> Flickr
        </a></li>
        <li class="list-group-item"><a href="https://delicious.com/jeffskinnerbox" target="_blank">
            <i class="fa fa-delicious"></i> Delicious
        </a></li>
        <li class="list-group-item"><a href="https://www.pinterest.com/jeffskinnerbox/my-electronics-projects-and-other-diversions/" target="_blank">
            <i class="fa fa-pinterest"></i> Pinterest
        </a></li>
        <li class="list-group-item"><a href="http://getpocket.com/a/queue/" target="_blank">
            <i class="fa fa-chevron-circle-down"></i> Pocket
        </a></li>
        <li class="list-group-item"><a href="http://jeffskinnerbox.tumblr.com/" target="_blank">
            <i class="fa fa-tumblr"></i> Tumblr
        </a></li>
        <li class="list-group-item"><a href="http://instagram.com/jeffskinnerbox" target="_blank">
            <i class="fa fa-instagram"></i> Instagram
        </a></li>
        <li class="list-group-item"><a href="https://www.facebook.com/jeff.irland" target="_blank">
            <i class="fa fa-facebook"></i> Facebook
        </a></li>
        <li class="list-group-item"><a href="https://linkedin.com/in/jeffreyirland" target="_blank">
            <i class="fa fa-linkedin"></i> Linkedin
        </a></li>
        <li class="list-group-item"><a href="http://www.commandlinefu.com/commands/by/jeffskinnerbox" target="_blank">
            <i class="fa fa-terminal"></i> CommandLineFu
        </a></li>
        <li class="list-group-item"><a href="https://disqus.com/by/jeffskinnerbox/" target="_blank">
            <i class="fa fa-comment"></i> DISQUS
        </a></li>
    </ul>
</li> 

<li class="list-group-item"><h4><i class="fa fa-thumbs-up fa-lg"></i><span class="icon-label">Reposted At</span></h4>
    <ul class="list-group" id="links">
        <li class="list-group-item">
            <a href="http://www.eeweb.com/websites/jeffs-skinner-box" target="_blank">
                EEWeb.com
            </a>
        </li>
    </ul>
</li>
<li class="list-group-item"><h4><i class="fa fa-gears fa-lg"></i><span class="icon-label">Admin</span></h4>
    <ul class="list-group" id="links">
        <li class="list-group-item">
            <a href="https://www.google.com/analytics/web/?hl=en#report/visitors-overview/a43272292w73270397p83408137/" target="_blank">
                Google Analytics
            </a>
        </li>
        <li class="list-group-item">
            <a href="https://github.com/jeffskinnerbox/jeffskinnerbox.github.io" target="_blank">
                Web Site Source Code
            </a>
        </li>
    </ul>
</li>
            <li class="list-group-item"><a href="../../../../../pages/this-blog-is-powered-by/index.html"><h4><i class="fa fa-rocket fa-lg"></i><span class="icon-label">This Blog Powered By</span></h4></a>

        </ul>
    </section>

</aside>        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">This Blog Powered By 
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://tiddlywiki.com/" target="_blank">TiddlyWiki</a>,
            <a href="http://ipython.org/notebook.html" target="_blank">Python Notebook</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>, And
            <a href="/pages/this-blog-is-powered-by/index.html" target="_blank">Other Things</a>.
            <p>
            <a href="http://opensource.org/">
                <img src="/images/logos/open_source_logo.png" alt="Open Source Logo" title="The Open Source Initiative (OSI) is a non-profit corporation with global scope formed to educate about and advocate for the benefits of open source, and to build bridges among different constituencies in the open source community. The OSI maintains the Open Source Definition and the list of Open Source Initiative-approved licenses." height="40px" width="40px">
            </a>
            <a href="http://www.oshwa.org/">
                <img src="/images/logos/open-soruce-hardware-logo-800-px.png" alt="Open Source Hardware Logo" title="The Open Source Hardware Association aims to be the voice of the open hardware community, ensuring that technological knowledge is accessible to everyone, and encouraging the collaborative development of technology that serves education, environmental sustainability, and human welfare." height="40px" width="40px">
            </a>
            <small>
                All my work on this blog is
                <a href="http://opensource.org/licenses/MIT/" target="_blank">MIT Licensed, open, and free</a>,
                except where indicated otherwise.
            </small>
            </p>
         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="http://code.jquery.com/jquery.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="../../../../../theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="../../../../../theme/js/respond.min.js"></script>

    <script type="text/javascript">
        $(document).ready(function () {
            if (!window.jXHR) {
                var jxhr = document.createElement('script');
                jxhr.type = 'text/javascript';
                jxhr.src = '../../../../../theme/js/jXHR.js';
                var s = document.getElementsByTagName('script')[0];
                s.parentNode.insertBefore(jxhr, s);
            }

            github.showRepos({
                user: 'jeffskinnerbox',
                count: 5,
                skip_forks: false,
                target: '#gh_repos'
            });
        });
    </script>
    <script src="../../../../../theme/js/github.js" type="text/javascript"></script>
</body>
</html>